webpackJsonp([12],{"4unp":function(e,s){},MmqK:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t("Xxa5"),i=t.n(r),n=t("exGp"),a=t.n(n),l=t("rjht"),o=t("Z1YF"),c=["login","session","M_INDEX","P_INDEX","WELCOME_INDEX","WELCOME_STAT","SELECT_COMPANY_LIST","SELECT_BANK_LIST","AGENT_MENAGE_LIST","SELECT_ORGANI_LIST","SELECT_PRODUCT_LIST","SELECT_PRODUCT_BY_CODE","ORGANI_MANAGE_SHOWCODE","ORGANI_LEVER_LIST","SELECT_ORGANI_SUPER","SELECT_NATION_LIST","TEAM_MANAGE_LIST","SELECT_AGENT_LEVEL_LIST","TEAM_MANAGE_COMPETENT_SEARCH","SELECT_AGENTBY_NAME","SELECT_ROLE_LIST","SELECT_SYSTEM_COMPANY_LIST"],_={data:function(){return{selectAll:!1,roleId:"",roleList:[],r_permission:[]}},created:function(){this.getRoleList()},activated:function(){this.getRoleList()},methods:{handleSave:function(){var e=this;return a()(i.a.mark(function s(){var t,r,n,a;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:for(t=[],r=0;r<e.r_permission.length;r++)e.r_permission[r]&&t.push(e.r_permission[r]);if(n={r_permission:t},0!==e.r_permission.length){s.next=6;break}return e.$message.error("还没有选择权限"),s.abrupt("return");case 6:return n.r_permission=n.r_permission.concat(c),s.next=9,e.$axios.send("USER_PERMIS_ASSIGN",n,{id:e.roleId});case 9:(a=s.sent)&&0===a.status_code&&e.$message.success("权限保存成功");case 11:case"end":return s.stop()}},s,e)}))()},getRoleList:function(){var e=this;return a()(i.a.mark(function s(){var t;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.$axios.send("SELECT_ROLE_LIST");case 2:(t=s.sent)&&0===t.status_code&&(e.roleList=t.result);case 4:case"end":return s.stop()}},s,e)}))()},changeLevel2:function(e,s){var t=s.marker;if(this.r_permission.includes(t)){for(var r=0;r<s.meta.btn.length;r++){var i=s.meta.btn[r].marker;this.r_permission.includes(i)||this.r_permission.push(i)}this.r_permission.includes(e.marker)||this.r_permission.push(e.marker)}else{for(var n=this.getSubMenu(e.id),a=!1,l=0;l<n.length;l++)this.r_permission.includes(n[l].marker)&&(a=!0);if(!a){var o=this.r_permission.indexOf(e.marker);o>-1&&this.r_permission.splice(o,1)}for(var c=0;c<s.meta.btn.length;c++){var _=s.meta.btn[c],u=this.r_permission.indexOf(_.marker);u>-1&&this.r_permission.splice(u,1)}}},changeLevel3:function(e,s){var t=e.marker,r=s.marker,i=this.getMenuItemById(e.pid);if(this.r_permission.includes(r))this.r_permission.includes(t)||this.r_permission.push(t),this.r_permission.includes(i.marker)||this.r_permission.push(i.marker);else{for(var n=!1,a=0;a<e.meta.btn.length;a++){var l=e.meta.btn[a];this.r_permission.includes(l.marker)&&(n=!0)}if(!n){var o=this.r_permission.indexOf(t);this.r_permission.splice(o,1)}var c=this.getSubMenu(i.id);n=!1;for(var _=0;_<c.length;_++)this.r_permission.includes(c[_].marker)&&(n=!0);if(!n){var u=this.r_permission.indexOf(i.marker);u>-1&&this.r_permission.splice(u,1)}}},getMenuItemById:function(e){var s={},t=l.a.filter(function(s){return s.id===e});return t.length>0&&(s=t[0]),s},selectAllAction:function(e){this.r_permission=e?o.a.getRoleAllMarker():[]},getRoleDetail:function(){var e=this;return a()(i.a.mark(function s(){var t,r,n;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.$axios.send("ROLE_MANAGE_DETAIL","",{id:e.roleId});case 2:if((t=s.sent)&&0===t.status_code&&t.result.r_permission){for(r=0;r<c.length;r++)(n=t.result.r_permission.indexOf(c[r]))>-1&&t.result.r_permission.splice(n,1);e.r_permission=t.result.r_permission||[]}case 4:case"end":return s.stop()}},s,e)}))()},getSubMenu:function(e){return l.a.filter(function(s){return s.pid===e&&!s.isSuper})},getLevel1:function(){return l.a.filter(function(e){return 0===e.pid&&10!==e.id})}}},u={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"permissionPage-wrap"},[t("section",{staticClass:"header-title"},[e._v("权限分配")]),e._v(" "),t("section",{staticClass:"role-select"},[t("span",[e._v("角色选择")]),e._v(" "),t("el-select",{on:{change:e.getRoleDetail},model:{value:e.roleId,callback:function(s){e.roleId=s},expression:"roleId"}},e._l(e.roleList,function(e){return t("el-option",{key:e.r_id,attrs:{label:e.r_name,value:e.r_id}})}),1)],1),e._v(" "),t("el-card",{staticClass:"pl20 pr20"},[t("section",{staticClass:"pt20"},[t("el-row",{staticClass:"level1-item"},[t("el-col",{attrs:{span:20,offset:4}},[t("el-row",{staticClass:"level2-item"},[t("el-col",{staticClass:"level2-checkbox",attrs:{span:6}},[t("el-checkbox",{staticClass:"tab subtable1",on:{change:e.selectAllAction},model:{value:e.selectAll,callback:function(s){e.selectAll=s},expression:"selectAll"}},[e._v("全选")])],1),e._v(" "),t("el-col",{staticClass:"level3-checkbox",attrs:{span:18}},[t("div",[e._v("功能权限")])])],1)],1)],1),e._v(" "),e._l(e.getLevel1(0),function(s,r){return t("el-row",{key:s.id,staticClass:"level1-item"},[t("el-col",{staticClass:"level1-title",attrs:{span:4}},[e._v(e._s(s.name))]),e._v(" "),t("el-col",{attrs:{span:20,offset:4}},[t("el-checkbox-group",{model:{value:e.r_permission,callback:function(s){e.r_permission=s},expression:"r_permission"}},e._l(e.getSubMenu(s.id),function(i,n){return t("el-row",{key:i.id,staticClass:"level2-item"},[t("el-col",{staticClass:"level2-checkbox",attrs:{span:6}},[t("el-checkbox",{attrs:{label:i.marker},on:{change:function(t){return e.changeLevel2(s,i)}}},[e._v(e._s(i.name))])],1),e._v(" "),t("el-col",{staticClass:"level3-checkbox",attrs:{span:18}},e._l(i.meta.btn,function(s,a){return t("el-checkbox",{key:s.marker+"_"+r+"_"+n+"_"+a,attrs:{label:s.marker},on:{change:function(t){return e.changeLevel3(i,s)}}},[e._v(e._s(s.name))])}),1)],1)}),1)],1)],1)}),e._v(" "),t("div",{staticClass:"save-btn tc"},[t("el-button",{directives:[{name:"has",rawName:"v-has",value:"USER_PERMIS_ASSIGN",expression:"'USER_PERMIS_ASSIGN'"}],staticClass:"permis-btn",attrs:{type:"success"},on:{click:e.handleSave}},[e._v("保存")])],1)],2)])],1)},staticRenderFns:[]};var p=t("VU/8")(_,u,!1,function(e){t("4unp")},"data-v-2ae15008",null);s.default=p.exports}});